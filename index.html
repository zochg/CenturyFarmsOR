<!DOCTYPE html>
<html lang="en">
<head>
    <title>Century Farms in Oregon</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--add required stylesheets-->
    <!--make sure you add bootstrap 3.3.7 rather than 4.0.0-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <!--leaflet css-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.2.0/leaflet.css">
    <!--animation-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
    <!--facebook and info icons-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!--Google Font-->
    <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="css/Storymap.css">
    <!-- Chroma -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/1.3.4/chroma.min.js"></script>
    <!--add required libraries-->
    <!--leaflet-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.2.0/leaflet.js"></script>
    <!--jquery-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <!--bootstrap-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <!--leaflet.ajax for asynchronously adding geojson data-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.min.js"></script>
    <!--story map plugin-->
    <script src="js/Storymap.js"></script>
    <!--add favicon for the web page-->
    <link rel="shortcut icon" href="img/farm.ico" type="image/x-icon">


</head>
<body>
<div class="navbar navbar-inverse navbar-fixed-bottom navbar-toggleable-md" role="navigation">
    <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">

            <a class="navbar-brand" href="#">Century Farms of Oregon</a>
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="javascript:window.scrollBy(0, $('section[data-scene=scene1]').offset().top  - $(window).scrollTop() - $('.navbar').height()  - 10);">Agriculture in OR</a>
                </li>
                <li>
                    <a href="javascript:window.scrollBy(0, $('section[data-scene=scene2]').offset().top  - $(window).scrollTop() - $('.navbar').height()  - 10);">Farms in Oregon</a>
                </li>
                <li>
                    <a href="javascript:window.scrollBy(0, $('section[data-scene=scene3]').offset().top  - $(window).scrollTop() - $('.navbar').height()  - 10);">The Century Farm Program</a>
                </li>
                <li>
                    <a href="javascript:window.scrollBy(0, $('section[data-scene=scene4]').offset().top  - $(window).scrollTop() - $('.navbar').height()  - 10);">Iwasaki Brothers, Inc.</a>
                </li>
                <li>
                    <a href="javascript:window.scrollBy(0, $('section[data-scene=scene5]').offset().top  - $(window).scrollTop() - $('.navbar').height()  - 10);">The Mosby Farm</a>
                </li>
                <li>
                    <a href="javascript:window.scrollBy(0, $('section[data-scene=scene6]').offset().top  - $(window).scrollTop() - $('.navbar').height()  - 10);">Jesse and Ruby Looney Farm</a>
                </li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</div>
<div id="storymap" class="container-fluid">
    <div class="row">
        <div class="col-sm-6 col-md-8 storymap-story">
            <section class="viewing section-opacity" data-scene="overview" data-background="Assets/Farming.mp4" style="height: 328.17px; width:0px; padding: 0px;">
                <div class="fullscreen text-center">
                    <h1>Century Farms in Oregon</h1>
                    <h1>
                        <small style="color: rgba(255,255,255,0.95)"> The Century Farm program is an important way of preserving Oregon's rich agricultural history and heritage. This story map is intended to demonstrate Oregon's agricultural history.
                        </small>
                    </h1>
                </div>
            </section>
            <section>
            </section>
            <section data-scene="scene1">
                <h2>Oregon's Agriculture</h2>
                <br>Oregon is a bountiful state.</br>
            </section>
            <section data-scene="scene2">
                <h2>Farming in Oregon</h2>
            </section>
            <section data-scene="scene3">
                <h2>Oregon's Century Farm Program</h2>
            </section>
            <section data-scene="scene4">
                <h2>Iwasaki Brothers, Inc.</h2>
                <br>The Iwasaki farm was originally founded in Hillsboro, OR in 1917 by Yasukichi (Billy) Iwasaki, an immigrant from Japan. The farm began as a dairy farm, but in 1928 Billy built his first greenhouse, branching out the farm into bedding plants and other crops.</br>
                <br>Billy and his family were sent to Japanese internment camps from 1942-1945. After the war, the Iwasakis returned to their farm as one of the few Japanese-American families to return to Washington County.</br>
                <br>The farm is now currently run by the grandson of Yasukichi, Jim Iwasaki. The farm now focuses primarily on wholesale starter plants, as well as holiday wreaths. Jim's daughters are the 4th generation of Iwasakis to keep the farm in the family.</br>
                <img src="img/Poinsettia.jpg" class="img-responsive" alt="Poinsettia starts at Iwasaki Brothers, Inc.">
                <small><a href="http://www.iwasaki-bros.com/index.html">Information and photos from Iwasaki Brothers, Inc.</a></small>
            </section>
            <section data-scene="scene5">
                <h2>The Mosby Farm</h2>
                <br>Originally founded in 1852 by David and Isabelle Mosby as a grain and hay farm, the Mosby Farm is now a small-scale beef operation.</br>
                <br>David Mosby arrived in Oregon in 1850 and laid claim to a parcel of land which he established as a farm. Originally, it was a subsistence farm, with additional income earned through the raising and sale of hogs, beef cattle, and timber.</br>
                <br>Currently, the farm runs 100 cow/calf pairs and harvests winter hay when it's available.</br>
                <iframe width="536" height="300" src="https://www.youtube.com/embed/ZBQZy39Lgok" frameborder="0" allowfullscreen></iframe>
                <small>Video courtesy of the <a href="https://www.youtube.com/watch?v=ZBQZy39Lgok#action=share">Register-Guard</a></small>
            </section>
            <section data-scene="scene6">
                <h2>Jesse and Ruby Looney Farm</h2>
                <br>As members of the first wagon train of settlers to Oregon, led by Dr. Marcus Whitman (pictured below), Jesse and Ruby Looney arrived in the Oregon Territory in 1843.</br>
                <br>Jesse Looney received his family's land grant in 1846 and quickly set about clearing the land to build the farm, using animal traction.</br>
                <br>Originally a grain and dairy farm, after 173 years in operation, the farm now primarily produces grass seed and produce, as well as hosting a purebread Hereford cattle herd.</br>
                <br>The farm is currently run by Smith Cox, the 6th generation of the family.</br>
                <img src="img/Whitman.jpg" class="img-responsive" alt="Marcus Whitman">
            </section>
            <section data-scene="scene7">
                <h2>Smith Bros Farm, LLC.</h2>
                <br>Originally founded by John and Sara McCoy in 1853 as members of a wagon train coming to Oregon.</br>
                <br>The farm passed down through generations to become the current 180 acres that can be seen today.</br>
                <br>Early on, the farm was multi-faceted: many varieties of grains and cereals were farmed, alongside sheep and dairy cattle.</br>
                <br>Today, the farm is well-known for its grass seed, like many other farms in Oregon</br>
                <img src="img/grass.jpg" class="img-responsive" alt="Grass Farming in Oregon">
            </section>
            <section class="viewing section-opacity" data-scene="end" data-background="img/end.jpg" style="height: 340.38px; width: 0px; padding: 0px;">
                <div class="fullscreen text-center end-bg-img">
                    <br>
                    <h1 class="">Thank you for reading my story map. I hope you have a better understanding of agriculture in Oregon!</h1>
                </div>
            </section>
        </div>
        <div class="col-sm-6 col-md-8 storymap-map"></div>
    </div>
    <dl>
        <dt>
            <!--facebook icon-->
            <a class="fa fa-facebook-square btn"
               href="https://facebook.com/sharer.php?u=https://github.com/zochg/CenturyFarmsOR/"
               target="_blank"></a>
        </dt>
        <dt>
            <!--facebook icon-->
            <a class="fa fa-git-square btn" href="https://github.com/zochg/CenturyFarmsOR/" style="top:40px"
               target="_blank"></a>
        </dt>
        <dt>
            <!--info icon-->
            <i class="fa fa-file-text-o btn" style="top:60px" data-toggle="modal" data-target="#info-modal"></i>
        </dt>
    </dl>
    <!--the info page-->
    <div class="modal fade" id="info-modal" role="dialog">
        <div class="modal-dialog modal-md">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">About</h4>
                </div>
                <div class="modal-body">
                    <p>This story map was completed as part of a project for GEOG371 Geovisualization, a course taught by Bo Zhao at OSU. This story map is meant to illustrate the Century Farm Progam in Oregon.</p>
                    <p><b>storymap.js</b> | Released Date: 02/20/2017 | Version: 2.1 | MIT License </p>
                    <p><b>Author: Grant Zoch</b> | College of Earth, Ocean, Atmospheric Science | Oregon State University
                    </p>
                    <p>The <a href="https://www.youtube.com/watch?v=GshpFSwoNb4">Background video</a> on the front page
                        was clipped from Youtube</p>
                    <p>This story map uses geospatial data from mapbox, Google Earth Engine, ESRI Map, Open Street Maps, the USDA,
                        and github.</p>
                    <p>Century Farm information can be found <a href="http://oregonfb.org/wp-content/uploads/2017/08/2017_family_arratives.pdf">here</a>and <a href="http://oregonfb.org/wp-content/uploads/2016/08/082016cfr.pdf">here</a></p>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">

    //BELOW HERE IS HOPEFULLY THE NLCD LAYER

    $(document).ready(function () {
        $("#basemapslider").slider({
            animate: true,
            value: 1,
            orientation: "vertical",
            min: 0,
            max: 1,
            step: 0.1,
            slide: function (event, ui) {
                mytile.setOpacity(ui.value);
            }
        });

        $('#basemapslider').mousedown(function(){
            map.dragging.disable();
        });

        $('#basemapslider').mouseup(function(){
            map.dragging.enable();
        });

        var mytile =L.tileLayer('nlcd/{z}/{x}/{y}.png', {
            maxZoom: 10,
            tms: false,
            attribution: 'Generated by QTiles, Data From <a target="_blank" href="http://spatialdata.oregonexplorer.info/geoportal/details;id=81916ee1b2b741c0aacb814ee8e73af9">Oregon Spatial Data Library</a>'
        }).addTo(layers);

        L.control.layers({'Basemap':layers.layer3.layer},{'nlcd':mytile}).addTo(layers);
    })

    //ABOVE IS NLCD STUFF, BELOW WORKS

    //Layer 2 Choropleth ramp and style
    colors = chroma.scale('Blues').mode('hsl').colors(5);

    function setColor(Total_Reco) {
        var id = 0;
        if (Total_Reco > 68) { id = 4; }
        else if (Total_Reco > 41 && Total_Reco <= 68) { id = 3; }
        else if (Total_Reco > 26 && Total_Reco <= 41) { id = 2; }
        else if (Total_Reco > 11 && Total_Reco <= 26) { id = 1; }
        else { id = 0; }
        return colors[id];
    }

    function style(feature) {
        return {
            fillColor: setColor(feature.properties.Total_Reco),
            fillOpacity: 0.6,
            weight: 2,
            opacity: 1,
            color: '#08519c',
            dashArray: '5'
        };
    }

    //Farms in County Choropleth and style

    function setColor(density){
        //Tenary operation: condition ? valueIfTrue : valueIfFalse
        // condition ? value1 : value2
        return  density > 77 ? '#08519c' :
            density > 59 ? '#3182bd' :
                density > 40 ? '#6baed6' :
                    density >  21 ? '#bdd7e7' :
                        density > 3 ? '#eff3ff' :
                        '#ffffff';
    }

    // Set style function that sets fill color property equal to percentage farmland
    function style(feature) {
        return {
            fillColor: setColor(feature.properties.farmland),
            fillOpacity: 0.5,
            weight: 2,
            opacity: 0.8,
            color: '#08519c',
            dashArray: '5'
        };
    }



    //Interactive functions
    function highlightFeature(e) {
        var layer=e.target;

        layer.setStyle({
            weight: 5,
            color: '#666',
            dashArray: '',
            fillOpacity: 0.7
        });

        if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
            layer.bringToFront();
        }

        //info.update(layer.feature.properties);

    }


    function resetHighlight(e) {
        layers.layer2.layer.resetStyle(e.target);
        //info.update();
    }

    //this function isn't working
    function zoomToFeature(e) {
        layers.layer2.layer.fitBounds(e.target.getBounds());
    }

    function onEachFeature(feature, layer) {
        layer.on({
            mouseover: highlightFeature,
            mouseout: resetHighlight,
            click: zoomToFeature
        });
        layer.bindPopup('There are' + ' ' + feature.properties.Total_Reco + ' ' + 'in' + ' ' + feature.properties.COUNTY_NAM)
    }



    var layers = {
        //Terrain Layer
        layer1: {
            layer: L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}'),
        },
        //Century Farms by County
        layer2: {
            layer: L.geoJson.ajax('Assets/CountiesSimplified.geojson', {
                style: function (feature) {
                    return {
                        fillColor: setColor(feature.properties.Total_Reco),
                        fillOpacity: 0.6,
                        weight: 2,
                        opacity: 1,
                        color: '#08519c',
                        dashArray: '5'
                    }
                },
                onEachFeature: onEachFeature
            }),
            legend: '<p><b>Century Farms per County</b></p>' +
            '<i style="background: ' + colors[4] + '; opacity: 0.5"></i><p><b>68+</b></p>' +
            '<i style="background: ' + colors[3] + '; opacity: 0.5"></i><p><b>42-68</b></p>' +
            '<i style="background: ' + colors[2] + '; opacity: 0.5"></i><p><b>27-41</b></p>' +
            '<i style="background: ' + colors[1] + '; opacity: 0.5"></i><p><b>11-26</b></p>' +
            '<i style="background: ' + colors[0] + '; opacity: 0.5"></i><p><b>0-10</b></p>',
        },
        //Basemap
        layer3: {
            layer: L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiamFrb2J6aGFvIiwiYSI6ImNpcms2YWsyMzAwMmtmbG5icTFxZ3ZkdncifQ.P9MBej1xacybKcDN_jehvw', {id: 'mapbox.outdoors'})
        },
        //Percent Farms in Counties
        layer4: {
            layer: L.geoJson.ajax('Assets/FarmInCounty.geojson', {
                style: style,
                weight: 5,
            }),
            legend: '<p><b>Percent of all farms by County</b></p>' +
            '<i style="background: ' + colors[4] + '; opacity: 0.5"></i><p><b>77-96</b></p>' +
            '<i style="background: ' + colors[3] + '; opacity: 0.5"></i><p><b>59-76</b></p>' +
            '<i style="background: ' + colors[2] + '; opacity: 0.5"></i><p><b>40-58</b></p>' +
            '<i style="background: ' + colors[1] + '; opacity: 0.5"></i><p><b>21-39</b></p>' +
            '<i style="background: ' + colors[0] + '; opacity: 0.5"></i><p><b>3-20</b></p>',
        },

        layer5: {
            layer:L.geoJson.ajax('Assets/Iwasaki.geojson', {
                color: "blue",
                weight: 5,
            })
        },

        layer6: {
            layer: L.geoJson.ajax('Assets/Mosby.geojson', {
                color: "blue",
                weight: 5,
            })
        },

        layer7: {
            layer:L.geoJson.ajax('Assets/Cox.geojson', {
                color: "blue",
                weight: 5,
            })
        },

        layer8: {
            layer:L.geoJson.ajax('Assets/Smith.geojson', {
                color:"blue",
                weight: 5,
            })
        },

        //NLCD Raster Layer goes here
        layer9: {
            layer: L.tileLayer('Assets/nlcdTiles/Mapnik/{z}/{x}/{y}.png')
        }

    };

    var scenes = {
        scene1: {lat: 44, lng: -123.5, zoom:  7, layers: ['layer1', 'layer9'], name: "scene 1"},
        scene2: {lat: 44, lng: -123.5, zoom:  7, layers: ['layer3', 'layer4'], name: "scene 2"},
        scene3: {lat: 44, lng: -123.5, zoom:  7, layers: ['layer3', 'layer2'], name: "scene 3"},
        scene4: {lat: 45.501075, lng: -122.968480, zoom:  17, layers: ['layer1', 'layer5'], name: "scene 4"},
        scene5: {lat: 43.781699, lng: -122.999213, zoom:  16, layers: ['layer1', 'layer6'], name: "scene 5"},
        scene6: {lat: 44.756157, lng: -123.021073, zoom:  16, layers: ['layer1', 'layer7'], name: "scene 6"},
        scene7: {lat: 44.478207, lng: -123.214531, zoom:  15, layers: ['layer1', 'layer8'], name: "scene 7"},
    };
    $('#storymap').storymap({
        scenes: scenes,
        layers: layers,
        baselayer: layers.layer3,
        legend: true,
        loader: false,
        flyto: true,
        credits: "Made with love by Grant Zoch",
        scalebar: true,
        scrolldown: true,
        progressline: true,
        navwidget: true,
        navbar: true,
        createMap: function () {
            var map = L.map($(".storymap-map")[0], {zoomControl: false}).setView([44, -123.5], 1);
            basemap = this.baselayer.layer.addTo(map);
            return map;
        }
    });
</script>
</body>
</html>